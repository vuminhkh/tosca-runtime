tosca_definitions_version: tosca_simple_yaml_1_0_0_wd03
description: A topology that contains component that simply sleeps for testing purpose
template_name: sleep-openstack-sa
template_version: 1.0.0-SNAPSHOT
template_author: MKV

imports:
  - toscaruntime-openstack-provider-types:*
  - test-type:*
  - toscaruntime-script-plugin-types:*

topology_template:

  inputs:
    image:
      type: string
    flavor:
      type: string
    key_pair_name:
      type: string
    plugin_configs:
      type: com.toscaruntime.common.datatypes.PluginConfiguration
    security_group_names:
      type: list
      entry_schema:
        type: string
    external_network_name:
      type: string
    cloud_init:
      type: string

  node_templates:

    Server:
      type: com.toscaruntime.openstack.nodes.Compute
      properties:
        image: { get_input: image }
        flavor: { get_input: flavor }
        key_pair_name: { get_input: key_pair_name }
        security_group_names: { get_input: security_group_names }
        plugins: { get_input: plugin_configs }
        user_data: { get_input: cloud_init }
      requirements:
        - network: publicNetwork
        - network: Network

    Sleep:
      type: com.toscaruntime.nodes.Sleep
      properties:
        start_sleep_time: 120
      requirements:
        - host: Server

    Network:
      type: com.toscaruntime.openstack.nodes.Network
      properties:
        network_name: sleepStandAlone
        cidr: "192.168.1.0/24"

    publicNetwork:
      type: com.toscaruntime.openstack.nodes.ExternalNetwork
      properties:
        network_name: { get_input: external_network_name}