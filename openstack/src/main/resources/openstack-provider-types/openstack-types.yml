tosca_definitions_version: tosca_simple_yaml_1_0_0_wd03
template_name: openstack-provider-types
template_version: 1.0.0-SNAPSHOT
template_author: mkv

imports:
  - tosca-normative-types:*

data_types:

  com.toscaruntime.openstack.OpenstackFailSafeConfiguration:
    properties:
      operation_retry:
        type: integer
        description: the number of times tosca runtime will retry to instantiate resources on Openstack if failures happens
      wait_between_operation_retry:
        type: scalar-unit.time
        description: wait time in seconds between retry when Openstack failures happen

  com.toscaruntime.openstack.ComputeFailSafeConfiguration:
    properties:
      connect_retry:
        type: integer
        description: the number of times tosca runtime will retry to connect to the VM, default to infinite
      wait_between_connect_retry:
        type: scalar-unit.time
        description: wait time in seconds between retry when connect fails
      artifact_execution_retry:
        type: integer
        description: the number of times tosca runtime will retry to execute artifact if failures happens
      wait_between_artifact_execution_retry:
        type: scalar-unit.time
        description: wait time in seconds between retry when artifact execution failures happen
      wait_before_artifact_execution:
        type: scalar-unit.time
        description: wait time in seconds before artifact execution (sometimes dns resolution needs sometimes at the beginning)

node_types:

  com.toscaruntime.openstack.nodes.Compute:
    derived_from: tosca.nodes.Compute
    properties:
      image:
        type: string
      flavor:
        type: string
      login:
        type: string
        default: root
      admin_pass:
        type: string
        required: false
      key_pair_name:
        type: string
      key_path:
        type: string
      ssh_port:
        type: integer
        default: 22
      networks:
        type: list
        entry_schema:
          type: string
        required: false
      security_group_names:
        type: list
        entry_schema:
          type: string
        required: false
      availability_zone:
        type: string
        required: false
      user_data:
        type: string
        required: false
      config_drive:
        type: boolean
        required: false
      openstack_fail_safe:
        type: com.toscaruntime.openstack.OpenstackFailSafeConfiguration
        default:
          operation_retry: 60
          wait_between_operation_retry: 10 s
      compute_fail_safe:
        type: com.toscaruntime.openstack.ComputeFailSafeConfiguration
        default:
          connect_retry: 600
          wait_between_connect_retry: 5 s
          artifact_execution_retry: 6
          wait_between_artifact_execution_retry: 10 s
          wait_before_artifact_execution: 10 s

  com.toscaruntime.openstack.nodes.Network:
    derived_from: tosca.nodes.Network
    properties:
      dns_name_servers:
        type: list
        entry_schema:
          type: string
        required: false
      openstack_fail_safe:
        type: com.toscaruntime.openstack.OpenstackFailSafeConfiguration
        default:
          operation_retry: 60
          wait_between_operation_retry: 10 s

  com.toscaruntime.openstack.nodes.ExternalNetwork:
    derived_from: tosca.nodes.Network
